import{r as x,u as S,a as E,C as I,R as T,b as O}from"./convex-BXJdso_C.js";import{r as B}from"./vendor-CgVA3q3W.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function l(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=l(s);fetch(s.href,i)}})();var R={exports:{}},P={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D=x,U=Symbol.for("react.element"),q=Symbol.for("react.fragment"),Y=Object.prototype.hasOwnProperty,z=D.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,V={key:!0,ref:!0,__self:!0,__source:!0};function W(t,a,l){var n,s={},i=null,d=null;l!==void 0&&(i=""+l),a.key!==void 0&&(i=""+a.key),a.ref!==void 0&&(d=a.ref);for(n in a)Y.call(a,n)&&!V.hasOwnProperty(n)&&(s[n]=a[n]);if(t&&t.defaultProps)for(n in a=t.defaultProps,a)s[n]===void 0&&(s[n]=a[n]);return{$$typeof:U,type:t,key:i,ref:d,props:s,_owner:z.current}}P.Fragment=q;P.jsx=W;P.jsxs=W;R.exports=P;var e=R.exports,M={},$=B;M.createRoot=$.createRoot,M.hydrateRoot=$.hydrateRoot;const H=Symbol.for("functionName");function A(t=[]){const a={get(l,n){if(typeof n=="string"){const s=[...t,n];return A(s)}else if(n===H){if(t.length<2){const d=["api",...t].join(".");throw new Error(`API path is expected to be of the form \`api.moduleName.functionName\`. Found: \`${d}\``)}const s=t.slice(0,-1).join("/"),i=t[t.length-1];return i==="default"?s:s+":"+i}else return n===Symbol.toStringTag?"FunctionReference":void 0}};return new Proxy({},a)}const J=A(),v=J;function K({value:t,onChange:a}){const[l,n]=x.useState(t),s=x.useRef(null);x.useEffect(()=>{n(t)},[t]);const i=u=>{n(u),s.current&&clearTimeout(s.current),s.current=window.setTimeout(()=>{a(u)},300)},d=()=>{n(""),a("")};return e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:l,onChange:u=>i(u.target.value),placeholder:"Search products, brands, strains...",className:"w-full bg-neutral-900 border border-neutral-700 rounded-xl px-4 py-3 pl-11 text-white placeholder-neutral-500 focus:outline-none focus:border-cannabis-500 focus:ring-1 focus:ring-cannabis-500 transition-colors"}),e.jsx("svg",{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-neutral-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),l&&e.jsx("button",{onClick:d,className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded-full hover:bg-neutral-700 text-neutral-400 hover:text-neutral-200 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}function Q({options:t,filters:a,onChange:l,onClear:n}){return e.jsx("div",{className:"bg-neutral-900 border-t border-neutral-800 px-4 py-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-neutral-500 mb-2 font-medium",children:"Category"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>l("category",null),className:`px-3 py-1.5 rounded-full text-sm transition-colors ${a.category?"bg-neutral-800 text-neutral-400 hover:bg-neutral-700":"bg-cannabis-600 text-white"}`,children:"All"}),t.categories.slice(0,8).map(s=>e.jsx("button",{onClick:()=>l("category",s),className:`px-3 py-1.5 rounded-full text-sm transition-colors ${a.category===s?"bg-cannabis-600 text-white":"bg-neutral-800 text-neutral-400 hover:bg-neutral-700"}`,children:X(s)},s))]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-neutral-500 mb-2 font-medium",children:"Strain Type"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>l("strain",null),className:`px-3 py-1.5 rounded-full text-sm transition-colors ${a.strain?"bg-neutral-800 text-neutral-400 hover:bg-neutral-700":"bg-cannabis-600 text-white"}`,children:"All"}),["Indica","Sativa","Hybrid"].map(s=>e.jsx("button",{onClick:()=>l("strain",s),className:`px-3 py-1.5 rounded-full text-sm transition-colors ${a.strain===s?"bg-cannabis-600 text-white":"bg-neutral-800 text-neutral-400 hover:bg-neutral-700"}`,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-neutral-500 mb-2 font-medium",children:"Dispensary"}),e.jsxs("select",{value:a.retailerId||"",onChange:s=>l("retailerId",s.target.value||null),className:"w-full bg-neutral-800 border border-neutral-700 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-cannabis-500",children:[e.jsx("option",{value:"",children:"All Dispensaries"}),t.retailers.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.city,")"]},s.id))]})]}),e.jsx("button",{onClick:n,className:"w-full py-2 text-sm text-neutral-400 hover:text-white transition-colors",children:"Clear all filters"})]})})}function X(t){return t.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}function G({inStock:t,stockLevel:a,lastInStockAt:l,size:n="md"}){const i=t?a==="low"?{emoji:"üü°",text:"Low Stock",color:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30"}:{emoji:"üü¢",text:"In Stock",color:"bg-green-500/20 text-green-400 border-green-500/30"}:{emoji:"üî¥",text:"Sold Out",color:"bg-red-500/20 text-red-400 border-red-500/30"},d=n==="sm"?"text-xs px-2 py-0.5":"text-sm px-2.5 py-1";return e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border font-medium ${i.color} ${d}`,children:[e.jsx("span",{children:i.emoji}),e.jsx("span",{children:i.text})]}),!t&&l&&e.jsxs("span",{className:"text-xs text-neutral-500",children:["Last seen ",Z(l)]})]})}function Z(t){const l=Date.now()-t,n=Math.floor(l/6e4),s=Math.floor(n/60),i=Math.floor(s/24);return i>0?`${i}d ago`:s>0?`${s}h ago`:n>0?`${n}m ago`:"just now"}const L=()=>{try{return localStorage.getItem("cannasignal_email")}catch{return null}},ee=t=>{try{localStorage.setItem("cannasignal_email",t)}catch{}};function te({productId:t,productName:a}){const[l,n]=x.useState(L()||""),[s,i]=x.useState(!1),[d,u]=x.useState(!1),[b,f]=x.useState(null),[w,r]=x.useState(!1),m=L(),g=S(v.alerts.checkWatchExists,m?{email:m,productId:t}:"skip"),j=S(v.alerts.getWatcherCount,{productId:t}),c=E(v.alerts.watchProduct),y=E(v.alerts.unwatchProduct);x.useEffect(()=>{i(!1),f(null),r(!1)},[t]);const N=async()=>{if(m&&!g){u(!0),f(null);try{await c({email:m,productId:t,alertTypes:["restock","price_drop"]}),r(!0),setTimeout(()=>r(!1),2e3)}catch(p){f(p.message||"Failed to watch product")}finally{u(!1)}return}if(m&&g){u(!0);try{await y({email:m,productId:t})}catch(p){f(p.message||"Failed to unwatch")}finally{u(!1)}return}i(!0)},h=async p=>{if(p.preventDefault(),!l.trim()){f("Please enter your email");return}u(!0),f(null);try{await c({email:l.trim(),productId:t,alertTypes:["restock","price_drop"]}),ee(l.trim()),i(!1),r(!0),setTimeout(()=>r(!1),2e3)}catch(o){f(o.message||"Failed to watch product")}finally{u(!1)}};return s?e.jsx("div",{className:"mt-4 p-4 bg-neutral-800 rounded-lg border border-neutral-700",children:e.jsxs("form",{onSubmit:h,children:[e.jsx("p",{className:"text-sm text-neutral-300 mb-3",children:"Enter your email to get notified when this product restocks or drops in price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"email",value:l,onChange:p=>n(p.target.value),placeholder:"your@email.com",className:"flex-1 px-3 py-2 bg-neutral-900 border border-neutral-600 rounded-lg text-white text-sm focus:outline-none focus:border-cannabis-500",autoFocus:!0}),e.jsx("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-cannabis-600 text-white rounded-lg text-sm font-medium hover:bg-cannabis-500 disabled:opacity-50",children:d?"...":"Watch"})]}),b&&e.jsx("p",{className:"text-red-400 text-xs mt-2",children:b}),e.jsx("button",{type:"button",onClick:()=>i(!1),className:"text-xs text-neutral-500 mt-2 hover:text-neutral-400",children:"Cancel"})]})}):e.jsxs("div",{className:"mt-4",children:[e.jsx("button",{onClick:N,disabled:d,className:`w-full py-3 rounded-lg font-medium flex items-center justify-center gap-2 transition-colors ${g?"bg-cannabis-600/20 text-cannabis-400 border border-cannabis-600 hover:bg-cannabis-600/30":w?"bg-green-600 text-white":"bg-cannabis-600 text-white hover:bg-cannabis-500"} disabled:opacity-50`,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"‚ü≥"}),e.jsx("span",{children:"Processing..."})]}):w?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"‚úì"}),e.jsx("span",{children:"You're watching this!"})]}):g?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"üîî"}),e.jsx("span",{children:"Watching ‚Ä¢ Tap to unwatch"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"üîî"}),e.jsx("span",{children:"Watch for Restocks & Deals"})]})}),j!==void 0&&j>0&&e.jsxs("p",{className:"text-center text-xs text-neutral-500 mt-2",children:[j," ",j===1?"person is":"people are"," watching this"]}),b&&!s&&e.jsx("p",{className:"text-center text-xs text-red-400 mt-2",children:b})]})}function se({productId:t,userLocation:a,onClose:l}){var w;const n=S(v.products.getById,{id:t}),s=S(v.inventory.getByProduct,{productId:t}),i=r=>{r.target===r.currentTarget&&l()},d=(r,m)=>!a||!r||!m?null:re(a.lat,a.lng,r,m),u=[...s||[]].sort((r,m)=>{var c,y,N,h,p,o,k,C;if(r.inStock!==m.inStock)return r.inStock?-1:1;const g=d((y=(c=r.retailer)==null?void 0:c.address)==null?void 0:y.lat,(h=(N=r.retailer)==null?void 0:N.address)==null?void 0:h.lng),j=d((o=(p=m.retailer)==null?void 0:p.address)==null?void 0:o.lat,(C=(k=m.retailer)==null?void 0:k.address)==null?void 0:C.lng);return g!==null&&j!==null?g-j:0}),b=u.filter(r=>r.inStock).length,f=u.length>0?Math.min(...u.map(r=>r.currentPrice)):null;return e.jsxs("div",{className:"fixed inset-0 z-50 bg-black/80 flex items-end sm:items-center justify-center",onClick:i,tabIndex:-1,children:[e.jsxs("div",{className:"w-full max-w-lg bg-neutral-900 rounded-t-2xl sm:rounded-2xl max-h-[85vh] overflow-hidden flex flex-col animate-slide-up",children:[e.jsxs("div",{className:"p-4 border-b border-neutral-800 flex items-start justify-between",children:[e.jsx("div",{className:"flex-1 min-w-0",children:n?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-cannabis-400 font-medium",children:(w=n.brand)==null?void 0:w.name}),e.jsx("h2",{className:"text-xl font-bold text-white truncate",children:n.name}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-neutral-800 text-neutral-400",children:ne(n.category)}),n.strain&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-neutral-800 text-neutral-400",children:n.strain})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"skeleton h-4 w-24 rounded"}),e.jsx("div",{className:"skeleton h-6 w-48 rounded"})]})}),e.jsx("button",{onClick:l,className:"p-2 -mr-2 -mt-2 rounded-full hover:bg-neutral-800 text-neutral-400 hover:text-white transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s&&e.jsxs("div",{className:"px-4 py-3 bg-neutral-800/50 border-b border-neutral-800",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-cannabis-400",children:b}),e.jsx("p",{className:"text-xs text-neutral-500",children:"In Stock"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:u.length}),e.jsx("p",{className:"text-xs text-neutral-500",children:"Locations"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:f?`$${f.toFixed(0)}`:"-"}),e.jsx("p",{className:"text-xs text-neutral-500",children:"Lowest Price"})]})]}),e.jsx(te,{productId:t,productName:n==null?void 0:n.name})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-neutral-400 mb-3",children:["Available at ",u.length," locations"]}),s?u.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-neutral-500",children:"Not available at any tracked location"}),e.jsx("p",{className:"text-xs text-neutral-600 mt-2",children:"This product hasn't been seen in recent inventory scans"})]}):e.jsx("div",{className:"space-y-3",children:u.map(r=>{var g,j,c,y,N,h,p,o,k;const m=d((j=(g=r.retailer)==null?void 0:g.address)==null?void 0:j.lat,(y=(c=r.retailer)==null?void 0:c.address)==null?void 0:y.lng);return e.jsxs("div",{className:"bg-neutral-800/50 rounded-lg p-3 border border-neutral-700/50",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-white truncate",children:((N=r.retailer)==null?void 0:N.name)||"Unknown"}),e.jsxs("p",{className:"text-xs text-neutral-500 mt-0.5",children:[(p=(h=r.retailer)==null?void 0:h.address)==null?void 0:p.city,", ",(k=(o=r.retailer)==null?void 0:o.address)==null?void 0:k.state,m!==null&&e.jsxs("span",{children:[" ‚Ä¢ ",m.toFixed(1)," mi away"]})]})]}),e.jsx(G,{inStock:r.inStock,stockLevel:r.stockLevel,lastInStockAt:r.lastInStockAt,size:"sm"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 pt-2 border-t border-neutral-700/50",children:[e.jsxs("div",{className:"flex items-baseline gap-1.5",children:[e.jsxs("span",{className:"text-lg font-bold text-white",children:["$",r.currentPrice.toFixed(2)]}),r.previousPrice&&r.currentPrice<r.previousPrice&&e.jsxs("span",{className:"text-xs text-green-400",children:["‚Üì $",(r.previousPrice-r.currentPrice).toFixed(2)," off"]})]}),e.jsxs("span",{className:"text-xs text-neutral-500",children:["Updated ",ae(r.lastUpdatedAt)]})]})]},r._id)})}):e.jsx("div",{className:"space-y-3",children:[1,2,3].map(r=>e.jsx("div",{className:"skeleton h-20 rounded-lg"},r))})]})})]}),e.jsx("style",{children:`
        @keyframes slide-up {
          from { transform: translateY(100%); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up {
          animation: slide-up 0.2s ease-out;
        }
      `})]})}function ne(t){return t.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}function ae(t){const l=Date.now()-t,n=Math.floor(l/6e4),s=Math.floor(n/60),i=Math.floor(s/24);return i>0?`${i}d ago`:s>0?`${s}h ago`:n>0?`${n}m ago`:"just now"}function re(t,a,l,n){const i=_(l-t),d=_(n-a),u=Math.sin(i/2)*Math.sin(i/2)+Math.cos(_(t))*Math.cos(_(l))*Math.sin(d/2)*Math.sin(d/2);return 3959*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))}function _(t){return t*(Math.PI/180)}const F=()=>{try{return localStorage.getItem("cannasignal_email")}catch{return null}},le=t=>{try{localStorage.setItem("cannasignal_email",t)}catch{}};function ie({onClose:t,onProductClick:a}){const[l,n]=x.useState(F()||""),[s,i]=x.useState(!!F()),[d,u]=x.useState(!1),b=S(v.alerts.getWatchesByEmail,s?{email:l}:"skip"),f=E(v.alerts.deleteWatch),w=E(v.alerts.toggleWatch),r=c=>{c.preventDefault(),l.trim()&&(le(l.trim()),i(!0),u(!1))},m=async c=>{confirm("Remove this from your watchlist?")&&await f({watchId:c})},g=async c=>{await w({watchId:c})},j=c=>{c.target===c.currentTarget&&t()};return!s||d?e.jsx("div",{className:"fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4",onClick:j,children:e.jsxs("div",{className:"w-full max-w-md bg-neutral-900 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"My Watchlist"}),e.jsx("button",{onClick:t,className:"p-2 -mr-2 rounded-full hover:bg-neutral-800 text-neutral-400",children:"‚úï"})]}),e.jsxs("form",{onSubmit:r,children:[e.jsx("p",{className:"text-neutral-400 mb-4",children:"Enter your email to view and manage your watched products."}),e.jsx("input",{type:"email",value:l,onChange:c=>n(c.target.value),placeholder:"your@email.com",className:"w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-cannabis-500",autoFocus:!0}),e.jsx("button",{type:"submit",className:"w-full mt-4 py-3 bg-cannabis-600 text-white rounded-lg font-medium hover:bg-cannabis-500",children:"View Watchlist"}),d&&e.jsx("button",{type:"button",onClick:()=>u(!1),className:"w-full mt-2 py-2 text-neutral-500 text-sm hover:text-neutral-400",children:"Cancel"})]})]})}):e.jsxs("div",{className:"fixed inset-0 z-50 bg-black/80 flex items-end sm:items-center justify-center",onClick:j,children:[e.jsxs("div",{className:"w-full max-w-lg bg-neutral-900 rounded-t-2xl sm:rounded-2xl max-h-[85vh] overflow-hidden flex flex-col animate-slide-up",children:[e.jsxs("div",{className:"p-4 border-b border-neutral-800 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{children:"üîî"}),e.jsx("span",{children:"My Watchlist"})]}),e.jsxs("button",{onClick:()=>u(!0),className:"text-xs text-neutral-500 hover:text-neutral-400",children:[l," ‚Ä¢ Change"]})]}),e.jsx("button",{onClick:t,className:"p-2 -mr-2 rounded-full hover:bg-neutral-800 text-neutral-400",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:b?b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-4xl mb-4",children:"üëÄ"}),e.jsx("p",{className:"text-neutral-400 mb-2",children:"No watched products yet"}),e.jsx("p",{className:"text-sm text-neutral-600",children:'Find a product and tap "Watch" to get alerted when it restocks'})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-neutral-500 mb-2",children:"You'll be notified when these products restock or drop in price"}),b.map(c=>{var y,N;return e.jsxs("div",{className:`bg-neutral-800/50 rounded-lg p-4 border transition-opacity ${c.isActive?"border-neutral-700/50":"border-neutral-800 opacity-50"}`,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("button",{onClick:()=>a(c.productId),className:"flex-1 text-left min-w-0",children:[e.jsx("p",{className:"text-xs text-cannabis-400 font-medium",children:((y=c.brand)==null?void 0:y.name)||"Unknown Brand"}),e.jsx("p",{className:"text-white font-medium truncate",children:((N=c.product)==null?void 0:N.name)||"Unknown Product"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:c.alertTypes.map(h=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-neutral-700 text-neutral-400",children:h==="restock"?"üì¶ Restock":h==="price_drop"?"üìâ Price Drop":h==="new_drop"?"üÜï New Drop":h},h))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>g(c._id),className:`p-2 rounded-lg transition-colors ${c.isActive?"text-cannabis-400 hover:bg-cannabis-600/20":"text-neutral-600 hover:bg-neutral-700"}`,title:c.isActive?"Pause alerts":"Resume alerts",children:c.isActive?"üîî":"üîï"}),e.jsx("button",{onClick:()=>m(c._id),className:"p-2 rounded-lg text-neutral-500 hover:text-red-400 hover:bg-red-600/10",title:"Remove from watchlist",children:"üóëÔ∏è"})]})]}),c.lastNotifiedAt&&e.jsxs("p",{className:"text-xs text-neutral-600 mt-2",children:["Last alert: ",ce(c.lastNotifiedAt)]})]},c._id)})]}):e.jsx("div",{className:"space-y-3",children:[1,2,3].map(c=>e.jsx("div",{className:"h-20 bg-neutral-800 rounded-lg animate-pulse"},c))})}),e.jsx("div",{className:"p-4 border-t border-neutral-800 bg-neutral-800/50",children:e.jsxs("p",{className:"text-xs text-neutral-500 text-center",children:["Alerts are sent to Discord when products restock or prices drop.",e.jsx("br",{}),"Email notifications coming soon!"]})})]}),e.jsx("style",{children:`
        @keyframes slide-up {
          from { transform: translateY(100%); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up {
          animation: slide-up 0.2s ease-out;
        }
      `})]})}function ce(t){const l=Date.now()-t,n=Math.floor(l/6e4),s=Math.floor(n/60),i=Math.floor(s/24);return i>0?`${i}d ago`:s>0?`${s}h ago`:n>0?`${n}m ago`:"just now"}function oe({count:t=3}){return e.jsx("div",{className:"space-y-3",children:Array.from({length:t}).map((a,l)=>e.jsx("div",{className:"bg-neutral-900 border border-neutral-800 rounded-xl p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg skeleton flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"skeleton h-3 w-20 rounded"}),e.jsx("div",{className:"skeleton h-5 w-3/4 rounded"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"skeleton h-4 w-16 rounded"}),e.jsx("div",{className:"skeleton h-4 w-12 rounded"})]}),e.jsxs("div",{className:"flex justify-between pt-1",children:[e.jsx("div",{className:"skeleton h-6 w-16 rounded"}),e.jsx("div",{className:"skeleton h-4 w-24 rounded"})]})]})]})},l))})}function de(){const[t,a]=x.useState({query:"",category:null,strain:null,retailerId:null,inStockOnly:!1}),[l,n]=x.useState(null),[s,i]=x.useState(null),[d,u]=x.useState(!1),[b,f]=x.useState(!1);x.useEffect(()=>{"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(o=>{i({lat:o.coords.latitude,lng:o.coords.longitude})},()=>{i({lat:40.7128,lng:-74.006})})},[]);const w=S(v.retailers.list,{}),r=S(v.products.list,{category:t.category||void 0,limit:100}),m=S(v.products.search,{query:t.query||""}),g=t.query?m:r,j={categories:[...new Set((r==null?void 0:r.map(o=>o.category))||[])].sort(),strains:[...new Set((r==null?void 0:r.map(o=>o.strain).filter(Boolean))||[])].sort(),retailers:(w||[]).map(o=>({id:o._id,name:o.name,city:o.address.city,region:o.region}))},c=x.useCallback(o=>{a(k=>({...k,query:o}))},[]),y=x.useCallback((o,k)=>{a(C=>({...C,[o]:k}))},[]),N=x.useCallback(()=>{a({query:"",category:null,strain:null,retailerId:null,inStockOnly:!1})},[]),h=[t.category,t.strain,t.retailerId,t.inStockOnly].filter(Boolean).length,p=(g||[]).filter(o=>!(t.strain&&o.strain!==t.strain)).slice(0,50);return e.jsxs("div",{className:"min-h-screen bg-neutral-950",children:[e.jsxs("header",{className:"sticky top-0 z-40 bg-neutral-950/95 backdrop-blur-sm border-b border-neutral-800",children:[e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h1",{className:"text-xl font-bold text-cannabis-400 flex items-center gap-2",children:[e.jsx("span",{children:"üåø"}),e.jsx("span",{children:"CannaSignal"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>f(!0),className:"text-sm px-3 py-1.5 rounded-full bg-neutral-800 text-neutral-300 hover:bg-neutral-700 flex items-center gap-1",children:[e.jsx("span",{children:"üîî"}),e.jsx("span",{children:"Alerts"})]}),e.jsx("span",{className:"text-xs text-neutral-500 flex items-center gap-1",children:s?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-cannabis-500"}),e.jsx("span",{children:"üìç NYC"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500 animate-pulse"}),e.jsx("span",{children:"..."})]})})]})]}),e.jsx(K,{value:t.query,onChange:c}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("button",{onClick:()=>u(!d),className:`text-sm px-3 py-1.5 rounded-full flex items-center gap-1 transition-colors ${h>0?"bg-cannabis-600 text-white":"bg-neutral-800 text-neutral-300 hover:bg-neutral-700"}`,children:[e.jsx("span",{children:"üéõÔ∏è"}),e.jsx("span",{children:"Filters"}),h>0&&e.jsx("span",{className:"ml-1 w-5 h-5 rounded-full bg-white/20 flex items-center justify-center text-xs font-medium",children:h})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-neutral-400 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.inStockOnly,onChange:o=>y("inStockOnly",o.target.checked),className:"w-4 h-4 rounded border-neutral-600 bg-neutral-800 text-cannabis-500 focus:ring-cannabis-500 focus:ring-offset-0"}),e.jsx("span",{children:"In stock only"})]})]})]}),d&&j.categories.length>0&&e.jsx(Q,{options:j,filters:t,onChange:y,onClear:N})]}),e.jsxs("main",{className:"max-w-3xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm text-neutral-500",children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-neutral-300 font-medium",children:p.length})," ","products found"]}):e.jsx("span",{className:"skeleton inline-block w-24 h-4 rounded"})}),p.length>0&&e.jsxs("p",{className:"text-xs text-neutral-600",children:["Sorted by ",s?"distance":"last updated"]})]}),g?p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-4xl mb-4",children:"üîç"}),e.jsx("p",{className:"text-neutral-400 mb-2",children:"No products found"}),e.jsx("p",{className:"text-sm text-neutral-600",children:"Try adjusting your search or filters"}),h>0&&e.jsx("button",{onClick:N,className:"mt-4 text-sm text-cannabis-400 hover:text-cannabis-300",children:"Clear all filters"})]}):e.jsx("div",{className:"space-y-3",children:p.map(o=>e.jsx(ue,{product:o,onClick:()=>n(o._id)},o._id))}):e.jsx(oe,{count:6})]}),l&&e.jsx(se,{productId:l,userLocation:s,onClose:()=>n(null)}),b&&e.jsx(ie,{onClose:()=>f(!1),onProductClick:o=>{f(!1),n(o)}}),e.jsx("footer",{className:"border-t border-neutral-800 mt-8 py-6",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 text-center",children:[e.jsx("p",{className:"text-xs text-neutral-600",children:"Real-time inventory tracking for NYS licensed dispensaries"}),e.jsx("p",{className:"text-xs text-neutral-700 mt-1",children:"Data updates every 15 minutes ‚Ä¢ Not affiliated with any dispensary"})]})})]})}function ue({product:t,onClick:a}){var l,n;return e.jsx("button",{onClick:a,className:"w-full bg-neutral-900 border border-neutral-800 rounded-xl p-4 text-left hover:border-neutral-700 transition-colors active:bg-neutral-800",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-neutral-800 flex-shrink-0 overflow-hidden",children:t.imageUrl?e.jsx("img",{src:t.imageUrl,alt:t.name,className:"w-full h-full object-cover",loading:"lazy"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-2xl",children:me(t.category)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-cannabis-400 font-medium truncate",children:((l=t.brand)==null?void 0:l.name)||"Unknown Brand"}),e.jsx("h3",{className:"text-white font-medium truncate leading-tight",children:t.name})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border text-xs px-2 py-0.5 font-medium bg-neutral-500/20 text-neutral-400 border-neutral-500/30",children:[e.jsx("span",{children:"‚ö™"}),e.jsx("span",{children:"Check"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1.5",children:[e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-neutral-800 text-neutral-400",children:xe(t.category)}),t.strain&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-neutral-800 text-neutral-400",children:t.strain}),t.weight&&e.jsxs("span",{className:"text-xs px-1.5 py-0.5 rounded bg-neutral-800 text-neutral-400",children:[t.weight.amount,t.weight.unit]}),((n=t.thcRange)==null?void 0:n.max)&&e.jsxs("span",{className:"text-xs px-1.5 py-0.5 rounded bg-neutral-800 text-neutral-400",children:["THC ",t.thcRange.max,"%"]})]}),e.jsx("p",{className:"text-xs text-neutral-500 mt-2",children:"Tap to see availability across locations"})]})]})})}function xe(t){return t.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}function me(t){return{flower:"üå∏",pre_roll:"üö¨",preroll:"üö¨",vape:"üí®",edible:"üç™",concentrate:"üíé",tincture:"üíß",topical:"üß¥"}[t.toLowerCase()]||"üåø"}const he="https://quick-weasel-225.convex.cloud",pe=new I(he);M.createRoot(document.getElementById("root")).render(e.jsx(T.StrictMode,{children:e.jsx(O,{client:pe,children:e.jsx(de,{})})}));
